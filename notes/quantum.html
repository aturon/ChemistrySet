<html> 
        <head> 
                <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
                <title>JavaScript Surface Plot</title> 
                

                <!--[if IE]><script type="text/javascript" src="http://surface-plot.googlecode.com/svn/trunk/javascript/excanvas.js"></script><![endif]--> 
				<script type="text/javascript" src='jsplot/SurfacePlot.js'></script> 
				<script type="text/javascript" src='jsplot/ColourGradient.js'></script> 
                <script type="text/javascript" src="http://www.google.com/jsapi"></script> 
        </head>
<body>
		
    <script type='text/javascript'>
			
      google.load("visualization", "1");
      google.setOnLoadCallback(setUp);
			
        function isIE() {
          return /msie/i.test(navigator.userAgent) && !/opera/i.test(navigator.userAgent);
        }
	
        function setUp() {
          var numRows = 25;
          var numCols = 8;
				
          var ttsAmdahl = new Array();
          var dataAmdahl = new google.visualization.DataTable();

          var ttsSpdLock = new Array();
          var dataSpdLock = new google.visualization.DataTable();

          var ttsSpdCAS = new Array();
          var dataSpdCAS = new google.visualization.DataTable();

          var ttsPercLock = new Array();
          var dataPercLock = new google.visualization.DataTable();

          var ttsPercCAS = new Array();
          var dataPercCAS = new google.visualization.DataTable();
				
          for (var i = 0; i < numCols; i++)
          {
            dataPercLock.addColumn('number', 'col'+i);
            dataPercCAS.addColumn('number', 'col'+i);
            dataAmdahl.addColumn('number', 'col'+i);
          }
				
          dataPercLock.addRows(numRows);
          dataPercCAS.addRows(numRows);
          dataAmdahl.addRows(numRows);
          var idx = 0;          

var amdahl = [
[1,1.25,1.36363636363636,1.42857142857143,1.47058823529412,1.5,1.52173913043478,1.53846153846154],
[1,1.36842105263158,1.56,1.67741935483871,1.75675675675676,1.81395348837209,1.85714285714286,1.89090909090909],
[1,1.47826086956522,1.75862068965517,1.94285714285714,2.07317073170732,2.17021276595745,2.24528301886792,2.30508474576271],
[1,1.58620689655172,1.97142857142857,2.24390243902439,2.4468085106383,2.60377358490566,2.72881355932203,2.83076923076923],
[1,1.67567567567568,2.16279069767442,2.53061224489796,2.81818181818182,3.04918032786885,3.23880597014925,3.3972602739726],
[1,1.75,2.33333333333333,2.8,3.18181818181818,3.5,3.76923076923077,4],
[1,1.80645161290323,2.47058823529412,3.02702702702703,3.5,3.90697674418605,4.26086956521739,4.57142857142857],
[1,1.85,2.58139534883721,3.21739130434783,3.77551020408163,4.26923076923077,4.70909090909091,5.10344827586207],
[1,1.88679245283019,2.67857142857143,3.38983050847458,4.03225806451613,4.61538461538462,5.14705882352941,5.63380281690141],
[1,1.9136690647482,2.75172413793103,3.52317880794702,4.23566878980892,4.89570552147239,5.50887573964497,6.08],
[1,1.9344262295082,2.80952380952381,3.63076923076923,4.40298507462687,5.1304347826087,5.8169014084507,6.46575342465753],
[1,1.95061728395062,2.85542168674699,3.71764705882353,4.54022988505747,5.32584269662921,6.07692307692308,6.79569892473118],
[1,1.96273291925466,2.89024390243902,3.78443113772455,4.64705882352941,5.47976878612717,6.28409090909091,7.06145251396648],
[1,1.97189695550351,2.91685912240185,3.83599088838269,4.73033707865169,5.60088691796009,6.44857768052516,7.27429805615551],
[1,1.97887323943662,2.93728222996516,3.87586206896552,4.79522184300341,5.69594594594595,6.57859531772575,7.44370860927152],
[1,1.9841059602649,2.9526938239159,3.90612777053455,4.84476067270375,5.76893453145058,6.67898089171974,7.57522123893805],
[1,1.98807157057654,2.96442687747036,3.92927308447937,4.8828125,5.8252427184466,6.75675675675676,7.67754318618042],
[1,1.99103808812547,2.97323420074349,3.94670614359733,4.91156963890936,5.86793837123991,6.81592403214025,7.75563636363636],
[1,1.9932735426009,2.97988826815642,3.95991091314031,4.93340732519423,5.90044247787611,6.86108048511577,7.81538461538462],
[1,1.99495161968868,2.98489299202686,3.96986186688991,4.94989561586639,5.92503123698459,6.89530535936851,7.86075424782428],
[1,1.99621212121212,2.98865784499055,3.97735849056604,4.96233521657251,5.94360902255639,6.92120075046904,7.89513108614232],
[1,1.99715774514448,2.9914853358562,3.98299480396788,4.97169811320755,5.9576071596797,6.94073377234243,7.92108971348051],
[1,1.99786818262569,2.99361135758651,3.98723630561957,4.97874977864353,5.96815849991155,6.95546916416328,7.94068843777582],
[1,1.99840085287847,2.99520639147803,3.99042043640234,4.98404679606488,5.97608926673751,6.96655163259889,7.95543766578249],
[1,1.99880071956826,2.99640431482221,3.99281293671391,4.98802873104549,5.98205383848455,6.97489039457951,7.96654052977495]
];

var spdLock = [
[1,0.601949231567618,0.792494554246458,0.806917571635023,0.886337168533479,0.808373844114591,0.809998299365948,0.861801274486346],
[1,0.636307192623245,0.882068693324303,0.795264422116761,0.822596970473147,0.838853755461873,0.81612798711343,0.865509732586133],
[1,0.722640472081631,0.927253513111571,0.873582477986122,0.869665244592354,0.840512635797752,0.979329408124062,0.877473511714804],
[1,0.803001648243327,0.908732321651833,0.912206262754932,0.965175511373277,0.929761013791999,0.965285339494652,1.00014756513357],
[1,0.87463607945054,1.01191345128128,1.05513383236163,1.11824400336119,1.1261436253539,1.12491553989697,1.10925180337192],
[1,0.990684047735872,1.17690663550858,1.29011937393024,1.29170629870829,1.33536762098346,1.32413088543036,1.36753028149736],
[1,1.12047516819304,1.53161698040346,1.52713260808926,1.54238818821607,1.56936296545541,1.55230955661576,1.60083129822759],
[1,1.19395838581865,1.82982222976652,1.7648936050434,1.86930395219594,1.96464363465906,1.92346083103198,2.00527912927828],
[1,1.33577996674303,1.94074442123599,2.30518330717503,2.19027172078931,2.29012741686463,2.3939048203504,2.48052230665763],
[1,1.44032914797179,2.22639059792133,2.84001284593697,2.97118754163074,3.14450764456696,2.77975977377702,2.97115779668269],
[1,1.54659081589759,2.2817773907658,3.07708146441761,3.63695252917939,3.77538975391239,3.70366496603798,3.68269310890435],
[1,1.64004631542321,2.47892278232093,3.29810575499703,3.92935052441141,4.52455780026768,4.57508319889863,4.45762812806668],
[1,1.70845130006039,2.56795860567371,3.40115289324929,4.16791301325537,4.83469939612831,5.44560803189889,5.17186555891097],
[1,1.77461381638616,2.66195717592021,3.49189154267913,4.28301508959987,5.0909737452384,5.89504190213195,6.10412983929973],
[1,1.82004038466832,2.73005664710251,3.61816574441254,4.44953010783506,5.23903351243072,6.08773416793419,6.05567080681739],
[1,1.87465643001368,2.79468041337521,3.73009109497639,4.52651520090592,5.04786740574813,6.22408623473539,6.32613379176869],
[1,1.9060810482808,2.85149668782261,3.80159093217324,4.622357541517,5.50015560785997,6.3990968459033,7.04281598150114],
[1,1.93436986407948,2.7938239590845,3.82492047705405,4.67287149684842,5.57355230167436,6.11276469165491,6.58478299987086],
[1,1.94495328109727,2.9037964476368,3.88181051129829,4.69438261024077,5.43098163779852,6.43721337529738,7.36340582747506],
[1,1.96125204513621,2.93889356318779,3.90775814178398,4.56626386036874,5.64078144866045,6.56393901513514,7.13071896309314],
[1,1.96911232739746,2.95054152960991,3.91943447451359,4.74925889072391,5.68240707533609,6.56089165716853,7.29528527362465],
[1,1.97427170002419,2.95666264181748,3.93447745031554,4.75889852841848,5.68299035333944,6.5835487702033,7.30537675655492],
[1,1.98453203178593,2.97315525545148,3.9520307248601,4.78662677305209,5.72429571541125,6.67290494224579,7.25160361247929],
[1,1.98753103228221,2.9766592721146,3.95844148680131,4.64528152936163,5.73611940492749,6.67781051758212,7.2505096762107],
[1,1.98920671433865,2.98020726593084,3.96975038103951,4.79375093557289,5.75185336269626,6.69124422214052,7.43850585067384]
];

var spdCAS = [
[1,0.890353030786419,1.17397214832829,1.12139359953251,1.19311969230196,0.980161753157603,1.1904180435706,1.10586068251292],
[1,0.886625491885082,1.20234238861025,1.13434812453032,1.27268591826887,1.12236410959962,1.1439187933414,1.14965910038368],
[1,0.968212320553863,1.22817893664321,1.32346363440302,1.35019106108549,1.27360727200244,1.34234895556846,1.23085124375878],
[1,1.1235396987053,1.40083084785069,1.47017744448223,1.57658770815664,1.39243001884919,1.51587721582885,1.41940235541027],
[1,1.10887368635652,1.47402333153906,1.76063226938547,1.78474410153158,1.69224786490247,1.68571133256888,1.59367054523002],
[1,1.20604736137027,1.81029505568935,1.96970488014458,2.25424734169943,2.09126657300967,2.20102053597004,1.86457769200956],
[1,1.34350046602159,1.96425024325688,2.23347607609442,2.56749110387274,2.49001167117538,2.46571547306736,2.3909418110099],
[1,1.37670396316216,2.06144718338527,2.48150891290177,2.88655146061023,2.99330932926252,3.21642247143674,2.95149757003771],
[1,1.485465803375,2.17689820383728,2.78255866266162,3.30095565065245,3.67405361983494,3.82334657699601,3.72999155784041],
[1,1.61964818124702,2.33799007002717,3.18746366998544,3.7635284041288,4.18856826118716,4.7844978240324,4.54415607172611],
[1,1.6677319072509,2.50070568479154,3.33094567663779,3.9804974187604,4.64256575515396,5.33088315098895,5.65820687753927],
[1,1.72039691032827,2.59646455300029,3.49614439543612,4.26073206596986,4.95664315333468,5.74029078465603,6.24730762157298],
[1,1.78216985044221,2.63602534898029,3.59445944127567,4.3217366294084,5.04481390839502,5.77736009528224,6.21026142135613],
[1,1.81371358714303,2.73882275682812,3.67194186232494,4.42940387247561,5.32375656223131,5.7849286116154,6.24974621525054],
[1,1.88039650848664,2.80264850598448,3.73655804317388,4.54432176738601,5.44782837379256,6.17660833297541,6.63881283170475],
[1,1.96117620332822,2.9319917504927,3.93892241550786,4.78685693428665,5.69861653828183,6.57404930498362,6.77256815121248],
[1,1.91515570842226,2.87221850967937,3.8109626358901,4.66095387127859,5.58126600497549,6.46478986986635,6.42966756304613],
[1,1.86713650872607,2.79895375617185,3.86979886429085,4.70570780208207,5.61128501217535,6.30632254475802,6.52775640165241],
[1,1.94831787567447,2.91690979630605,3.89279236037169,4.72837590294936,5.65406644511511,6.44603993238131,7.05132544313493],
[1,1.96089144369506,2.93818960863403,3.91439616487688,4.73498608519081,5.66491473243217,6.60575532160696,6.86690134847609],
[1,1.97006650613715,2.95292471511345,3.92252142974715,4.75831500481944,5.68292767909503,6.47020549261958,7.16276555052344],
[1,1.97818574524346,2.96626422346298,3.94012178234753,4.44364481721286,5.61222362759608,6.64394636938738,7.04240728321135],
[1,1.98368559269948,2.9754476571262,3.95228794602034,4.7829075181286,5.72689467419192,6.65580727283206,7.42429397136089],
[1,1.98856095184802,2.97990496813818,3.96566453338499,4.7937997919294,5.53769724157353,6.38407175975953,7.37277797391823],
[1,1.9919960958847,2.98469676973831,3.95840311560699,4.80438341871774,5.74883616396265,6.68463971608863,7.024663489925]
]; 

var percLock = [
[1,0.481559385254094,0.581162673114069,0.564842300144516,0.602709274602765,0.538915896076394,0.532284596726195,0.560170828416125],
[1,0.464993717686217,0.565428649566861,0.474099943954223,0.46824750626933,0.462445019036674,0.439453531522616,0.45772149319459],
[1,0.488845025231692,0.527261801573246,0.449638040139916,0.419485588568077,0.38729503806367,0.436171921265339,0.380668655817452],
[1,0.506240169544706,0.460951177649481,0.406526704053828,0.394463035082992,0.357082128485333,0.353738105777543,0.353312998552618],
[1,0.521960240962419,0.467873961345107,0.416948046659033,0.396796259257196,0.369326672831118,0.347324152871413,0.326513635669961],
[1,0.566105170134784,0.504388558075106,0.460756919260799,0.405964836736891,0.381533605995274,0.351300030828463,0.34188257037434],
[1,0.620263039535435,0.61994020635378,0.504499165172345,0.440682339490304,0.401682187586802,0.364317549001658,0.350181846487286],
[1,0.645382911253326,0.708850052972616,0.548548012378353,0.495112938689736,0.460186797307529,0.408456933230728,0.392926315872095],
[1,0.707963382373806,0.724544583928103,0.680029075616635,0.543187386755748,0.496194273654004,0.465101507953792,0.440292709431729],
[1,0.752653201383753,0.809089315034068,0.806093871685116,0.701468336896281,0.642299180531847,0.504596564735034,0.488677269191232],
[1,0.799508811608075,0.812158054340371,0.847501250792987,0.826019726966167,0.735881053728687,0.636707536534375,0.569569061334784],
[1,0.840783237653673,0.868145953302267,0.887148699920088,0.865451887655172,0.8495477726241,0.752861792223825,0.655948442895888],
[1,0.870445124397859,0.888492007026347,0.898722362614923,0.896892673738498,0.882281640854639,0.866570536721704,0.732408176459702],
[1,0.899952612347848,0.912610813280643,0.910297142064215,0.905435494000922,0.908958495289991,0.914161570842994,0.839136613894232],
[1,0.919735710401786,0.929449890531933,0.93351251412779,0.92790912569087,0.919782870509782,0.92538511246178,0.813528729385611],
[1,0.94483685224321,0.946484999812431,0.954933200883475,0.934311415300475,0.875008613501957,0.931891606764692,0.835108783259185],
[1,0.958758767285243,0.961904882692161,0.967504892238091,0.946658824502682,0.944193379349294,0.947066333193689,0.917326781590524],
[1,0.971538352589057,0.939658220797363,0.969142453957245,0.951400843394345,0.949831431255583,0.896835801401304,0.849031941562493],
[1,0.97575833899818,0.974464874628774,0.980277232605699,0.951549770939694,0.920436333065215,0.938221521998188,0.94216806847614],
[1,0.983107573025892,0.984589253630889,0.984356199991767,0.922497000892714,0.952025605105704,0.951943195121424,0.907129104699691],
[1,0.98642439171334,0.987246343557017,0.985436561428937,0.957061279307171,0.956053309322834,0.947941245126274,0.924023324505589],
[1,0.988540692303385,0.988359396711283,0.987818875986479,0.957197806475065,0.953904848208383,0.948537861578491,0.922269160027599],
[1,0.993324809436508,0.993166747552854,0.99117043032793,0.961411395604664,0.959139358563632,0.959375246263279,0.91322102224558],
[1,0.994560740613875,0.993807732443348,0.991986070111986,0.932030079057301,0.959845000451102,0.95855322256342,0.911390420089168],
[1,0.995200119183628,0.994594504883321,0.994223982931347,0.961051187563654,0.961518153797391,0.959333243048603,0.933718446905834]
];

var percCAS = [
[1,0.712282424629135,0.860912908774079,0.784975519672755,0.81132139076533,0.653441168771735,0.782274714346395,0.718809443633395],
[1,0.647918628685253,0.770732300391183,0.676245997316154,0.724451984245355,0.618739188625429,0.61595627333768,0.607992793472136],
[1,0.654967158021731,0.698376258091236,0.681194517707438,0.651268629464765,0.58685825278544,0.597852896177549,0.533972230748292],
[1,0.708318505705514,0.710566372098178,0.655187774171429,0.644344541594451,0.534773847818891,0.555507799589456,0.501419310335151],
[1,0.661747199922441,0.681537669421286,0.695733719353934,0.633296294091851,0.554984514833606,0.520473084249378,0.469104636297547],
[1,0.689169920783011,0.775840738152579,0.703466028623066,0.70847773596268,0.597504735145621,0.583944223828786,0.46614442300239],
[1,0.743723472261952,0.79505366988969,0.737844775138336,0.733568886820784,0.637324415836555,0.578688325311727,0.523018521158415],
[1,0.744164304411976,0.798578638608707,0.771279797253254,0.764546062540007,0.701135518565995,0.683024076946027,0.5783339833182],
[1,0.787296875788751,0.812708662765917,0.820854805485179,0.818637001361808,0.796044950964237,0.74282162067351,0.662073501516673],
[1,0.846357508245624,0.849645514170276,0.904712432646245,0.88853226984695,0.855559682422941,0.868507123803948,0.747394090744425],
[1,0.86213259612123,0.890081684417329,0.917421478734985,0.904045176464228,0.904906884479161,0.916447224504153,0.875104029788912],
[1,0.881975631244242,0.909310370881959,0.94041858737997,0.938439720859183,0.930677722883516,0.944604812664916,0.91930317849096],
[1,0.908004259244289,0.912042525807527,0.949801782742146,0.929993958227124,0.920625322945504,0.919362908471677,0.879459489258503],
[1,0.919781118420515,0.938962987891192,0.957234250332928,0.936382291330949,0.950520272987459,0.897085977437474,0.859154542060867],
[1,0.950235958025275,0.954163844860672,0.964058569858029,0.947677066081211,0.95643961959822,0.938894708469572,0.891868983618698],
[1,0.988443280048603,0.992988750389384,1.0083956918206,0.988048173619113,0.987810921967411,0.984289281787552,0.894042290989498],
[1,0.963323321336398,0.968895043931841,0.96988999083403,0.954563352837855,0.958117330854126,0.95678890074022,0.837464200086759],
[1,0.937770362034587,0.941383546399383,0.980513553198977,0.95808634469998,0.956261749386722,0.925233690255463,0.841679018405107],
[1,0.977446313330501,0.978865492198695,0.983050489205224,0.958440199900422,0.958244481886775,0.939507989501824,0.902236523235769],
[1,0.982926816040311,0.984353414505116,0.986028304290476,0.956583017632391,0.956098711694759,0.958007655546663,0.873567743245086],
[1,0.986902386376105,0.988043753507283,0.986212693437376,0.958886249548054,0.95614089983509,0.934838581611883,0.907238331114686],
[1,0.990500500049561,0.991569033586456,0.989235983542425,0.893788141602587,0.942026467535299,0.957239765608402,0.889070511501243],
[1,0.992901138298537,0.993932512176545,0.99123494146811,0.960664369726915,0.959574829367683,0.956917084346349,0.934968552102069],
[1,0.995076112474498,0.994891362617486,0.99379616674185,0.961828808612774,0.926642323165411,0.916389068285415,0.926759567940508],
[1,0.996595646771114,0.996092801953997,0.99138206030377,0.963182787784532,0.961013778742423,0.958386345580935,0.881770884572835]
];

          var work = [10, 13, 17, 23, 31, 42, 56, 74, 100, 133, 177, 237, 316, 421, 562, 749, 1000, 1333, 1778, 2371, 3162, 4216, 5623, 7498, 10000]

//          var max = 0
//          var min = 100000
//          for (var i = 0; i < numRows; i++) {	
//	    for (var j = 0; j < numCols; j++) {
//	      if (bench[i][j] > max) max = bench[i][j]	
//	      if (bench[i][j] < min) min = bench[i][j]	
//            }
//          }
			
          for (var i = 0; i < numRows; i++) {	
	    for (var j = 0; j < numCols; j++) {
//	      data.setValue(i, j, (bench[i][j] - min)/(max - min));		

	      dataPercLock.setValue(i, j, percLock[i][j] );
	      ttsPercLock[idx] = "w:" + work[i] + ", threads:" + j + " = " + percLock[i][j] + "% of predicted speedup";

	      dataPercCAS.setValue(i, j, percCAS[i][j] );
	      ttsPercCAS[idx] = "w:" + work[i] + ", threads:" + j + " = " + percCAS[i][j] + "% of predicted speedup";

//	      dataPercLock.setValue(i, j, percLock[i][j] );
//	      ttsPercLock[idx] = "w:" + work[i] + ", threads:" + j + " = " + percLock[i][j] + "% of predicted speedup";

//	      dataPercCAS.setValue(i, j, percCAS[i][j] );
//	      ttsPercCAS[idx] = "w:" + work[i] + ", threads:" + j + " = " + percCAS[i][j] + "% of predicted speedup";
	      
	      dataAmdahl.setValue(i, j, amdahl[i][j] / 8 );
	      ttsAmdahl[idx] = "w:" + work[i] + ", threads:" + j + " = " + amdahl[i][j] + "speedup";

	      idx++;
	    }
          }

         // Don't fill polygons in IE. It's too slow.
         var fillPly = !isIE();
//	 var fillPly = false;

         // Define a colour gradient.
         var colour1 = {red:0, green:0, blue:255};
         var colour2 = {red:0, green:255, blue:255};
         var colour3 = {red:0, green:255, blue:0};
         var colour4 = {red:255, green:255, blue:0};
         var colour5 = {red:255, green:0, blue:0};
//         var colours = [colour1, colour2, colour3, colour4, colour5];
         var colours = [colour5, colour4, colour3, colour2, colour1];

         // Axis labels.
         var xAxisHeader = "Work between critical sections";
         var yAxisHeader = "Threads";
         var zAxisHeader = "Speedup as % of predicted";

         var w = 800;
         var h = w;

         var optionsPercLock = {xPos: 0, yPos: 0, width: w, height: h, colourGradient: colours,
		   fillPolygons: fillPly, tooltips: ttsPercLock, xTitle: xAxisHeader,
		   yTitle: yAxisHeader, zTitle: zAxisHeader};	
         var percLockPlot = new greg.ross.visualisation.SurfacePlot(document.getElementById("percLockPlot"));			
         percLockPlot.draw(dataPercLock, optionsPercLock);

         var optionsPercCAS = {xPos: 0, yPos: 0, width: w, height: h, colourGradient: colours,
		   fillPolygons: fillPly, tooltips: ttsPercCAS, xTitle: xAxisHeader,
		   yTitle: yAxisHeader, zTitle: zAxisHeader};
         var percCASPlot = new greg.ross.visualisation.SurfacePlot(document.getElementById("percCASPlot"));			
         percCASPlot.draw(dataPercCAS, optionsPercCAS);

         var optionsAmdahl = {xPos: 0, yPos: 0, width: w, height: h, colourGradient: colours,
		   fillPolygons: fillPly, tooltips: ttsAmdahl, xTitle: xAxisHeader,
		   yTitle: yAxisHeader, zTitle: zAxisHeader};
         var amdahlPlot = new greg.ross.visualisation.SurfacePlot(document.getElementById("amdahlPlot"));			
         amdahlPlot.draw(dataAmdahl, optionsAmdahl);
      }
			
      </script>

    See <a href="http://aturon.tumblr.com/post/8443742193/the-quantum-mechanics-of-parallelism">this post</a> for background.

    Work quantity is log scale.  Drag to rotate.  

    <p><h2>Predicted speedup</h2><p><div id='amdahlPlot' style='align:center;'></div>
		
    Observed speedup as a percentage of naively predicted speedup.  Work
    quantity is log scale.  Drag to rotate.  

    <p><h2>Lock-based</h2><p><div id='percLockPlot' style='align:center;'></div>

    <p><h2>CAS-based</h2><p><div id='percCASPlot' style='align:center;'></div>
		
    </body>
</html>
