<html> 
        <head> 
                <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"> 
                <title>JavaScript Surface Plot</title> 
                

                <!--[if IE]><script type="text/javascript" src="http://surface-plot.googlecode.com/svn/trunk/javascript/excanvas.js"></script><![endif]--> 
				<script type="text/javascript" src='jsplot/SurfacePlot.js'></script> 
				<script type="text/javascript" src='jsplot/ColourGradient.js'></script> 
                <script type="text/javascript" src="http://www.google.com/jsapi"></script> 
        </head>
<body>
		
    <script type='text/javascript'>
			
      google.load("visualization", "1");
      google.setOnLoadCallback(setUp);
			
        function isIE() {
          return /msie/i.test(navigator.userAgent) && !/opera/i.test(navigator.userAgent);
        }
	
        function setUp() {
          var numRows = 23;
          var numCols = 8;
				
          var tooltipStringsLock = new Array();
          var dataLock = new google.visualization.DataTable();

          var tooltipStringsCAS = new Array();
          var dataCAS = new google.visualization.DataTable();
				
          for (var i = 0; i < numCols; i++)
          {
            dataLock.addColumn('number', 'col'+i);
            dataCAS.addColumn('number', 'col'+i);
          }
				
          dataLock.addRows(numRows);
          dataCAS.addRows(numRows);
          var idx = 0;          

var benchLock = [
[1,0.481559385254094,0.581162673114069,0.564842300144516,0.602709274602765,0.538915896076394,0.532284596726195,0.560170828416125],
[1,0.464993717686217,0.565428649566861,0.474099943954223,0.46824750626933,0.462445019036674,0.439453531522616,0.45772149319459],
[1,0.488845025231692,0.527261801573246,0.449638040139916,0.419485588568077,0.38729503806367,0.436171921265339,0.380668655817452],
[1,0.506240169544706,0.460951177649481,0.406526704053828,0.394463035082992,0.357082128485333,0.353738105777543,0.353312998552618],
[1,0.521960240962419,0.467873961345107,0.416948046659033,0.396796259257196,0.369326672831118,0.347324152871413,0.326513635669961],
[1,0.566105170134784,0.504388558075106,0.460756919260799,0.405964836736891,0.381533605995274,0.351300030828463,0.34188257037434],
[1,0.620263039535435,0.61994020635378,0.504499165172345,0.440682339490304,0.401682187586802,0.364317549001658,0.350181846487286],
[1,0.645382911253326,0.708850052972616,0.548548012378353,0.495112938689736,0.460186797307529,0.408456933230728,0.392926315872095],
[1,0.707963382373806,0.724544583928103,0.680029075616635,0.543187386755748,0.496194273654004,0.465101507953792,0.440292709431729],
[1,0.752653201383753,0.809089315034068,0.806093871685116,0.701468336896281,0.642299180531847,0.504596564735034,0.488677269191232],
[1,0.799508811608075,0.812158054340371,0.847501250792987,0.826019726966167,0.735881053728687,0.636707536534375,0.569569061334784],
[1,0.840783237653673,0.868145953302267,0.887148699920088,0.865451887655172,0.8495477726241,0.752861792223825,0.655948442895888],
[1,0.870445124397859,0.888492007026347,0.898722362614923,0.896892673738498,0.882281640854639,0.866570536721704,0.732408176459702],
[1,0.899952612347848,0.912610813280643,0.910297142064215,0.905435494000922,0.908958495289991,0.914161570842994,0.839136613894232],
[1,0.919735710401786,0.929449890531933,0.93351251412779,0.92790912569087,0.919782870509782,0.92538511246178,0.813528729385611],
[1,0.94483685224321,0.946484999812431,0.954933200883475,0.934311415300475,0.875008613501957,0.931891606764692,0.835108783259185],
[1,0.958758767285243,0.961904882692161,0.967504892238091,0.946658824502682,0.944193379349294,0.947066333193689,0.917326781590524],
[1,0.971538352589057,0.939658220797363,0.969142453957245,0.951400843394345,0.949831431255583,0.896835801401304,0.849031941562493],
[1,0.97575833899818,0.974464874628774,0.980277232605699,0.951549770939694,0.920436333065215,0.938221521998188,0.94216806847614],
[1,0.983107573025892,0.984589253630889,0.984356199991767,0.922497000892714,0.952025605105704,0.951943195121424,0.907129104699691],
[1,0.98642439171334,0.987246343557017,0.985436561428937,0.957061279307171,0.956053309322834,0.947941245126274,0.924023324505589],
[1,0.988540692303385,0.988359396711283,0.987818875986479,0.957197806475065,0.953904848208383,0.948537861578491,0.922269160027599],
[1,0.993324809436508,0.993166747552854,0.99117043032793,0.961411395604664,0.959139358563632,0.959375246263279,0.91322102224558]
];

var benchCAS = [
[1,0.712282424629135,0.860912908774079,0.784975519672755,0.81132139076533,0.653441168771735,0.782274714346395,0.718809443633395],
[1,0.647918628685253,0.770732300391183,0.676245997316154,0.724451984245355,0.618739188625429,0.61595627333768,0.607992793472136],
[1,0.654967158021731,0.698376258091236,0.681194517707438,0.651268629464765,0.58685825278544,0.597852896177549,0.533972230748292],
[1,0.708318505705514,0.710566372098178,0.655187774171429,0.644344541594451,0.534773847818891,0.555507799589456,0.501419310335151],
[1,0.661747199922441,0.681537669421286,0.695733719353934,0.633296294091851,0.554984514833606,0.520473084249378,0.469104636297547],
[1,0.689169920783011,0.775840738152579,0.703466028623066,0.70847773596268,0.597504735145621,0.583944223828786,0.46614442300239],
[1,0.743723472261952,0.79505366988969,0.737844775138336,0.733568886820784,0.637324415836555,0.578688325311727,0.523018521158415],
[1,0.744164304411976,0.798578638608707,0.771279797253254,0.764546062540007,0.701135518565995,0.683024076946027,0.5783339833182],
[1,0.787296875788751,0.812708662765917,0.820854805485179,0.818637001361808,0.796044950964237,0.74282162067351,0.662073501516673],
[1,0.846357508245624,0.849645514170276,0.904712432646245,0.88853226984695,0.855559682422941,0.868507123803948,0.747394090744425],
[1,0.86213259612123,0.890081684417329,0.917421478734985,0.904045176464228,0.904906884479161,0.916447224504153,0.875104029788912],
[1,0.881975631244242,0.909310370881959,0.94041858737997,0.938439720859183,0.930677722883516,0.944604812664916,0.91930317849096],
[1,0.908004259244289,0.912042525807527,0.949801782742146,0.929993958227124,0.920625322945504,0.919362908471677,0.879459489258503],
[1,0.919781118420515,0.938962987891192,0.957234250332928,0.936382291330949,0.950520272987459,0.897085977437474,0.859154542060867],
[1,0.950235958025275,0.954163844860672,0.964058569858029,0.947677066081211,0.95643961959822,0.938894708469572,0.891868983618698],
[1,0.988443280048603,0.992988750389384,1.0083956918206,0.988048173619113,0.987810921967411,0.984289281787552,0.894042290989498],
[1,0.963323321336398,0.968895043931841,0.96988999083403,0.954563352837855,0.958117330854126,0.95678890074022,0.837464200086759],
[1,0.937770362034587,0.941383546399383,0.980513553198977,0.95808634469998,0.956261749386722,0.925233690255463,0.841679018405107],
[1,0.977446313330501,0.978865492198695,0.983050489205224,0.958440199900422,0.958244481886775,0.939507989501824,0.902236523235769],
[1,0.982926816040311,0.984353414505116,0.986028304290476,0.956583017632391,0.956098711694759,0.958007655546663,0.873567743245086],
[1,0.986902386376105,0.988043753507283,0.986212693437376,0.958886249548054,0.95614089983509,0.934838581611883,0.907238331114686],
[1,0.990500500049561,0.991569033586456,0.989235983542425,0.893788141602587,0.942026467535299,0.957239765608402,0.889070511501243],
[1,0.992901138298537,0.993932512176545,0.99123494146811,0.960664369726915,0.959574829367683,0.956917084346349,0.934968552102069]
];

          var work = [10, 13, 17, 23, 31, 42, 56, 74, 100, 133, 177, 237, 316, 421, 562, 749, 1000, 1333, 1778, 2371, 3162, 4216, 5623]

//          var max = 0
//          var min = 100000
//          for (var i = 0; i < numRows; i++) {	
//	    for (var j = 0; j < numCols; j++) {
//	      if (bench[i][j] > max) max = bench[i][j]	
//	      if (bench[i][j] < min) min = bench[i][j]	
//            }
//          }
			
          for (var i = 0; i < numRows; i++) {	
	    for (var j = 0; j < numCols; j++) {
//	      data.setValue(i, j, (bench[i][j] - min)/(max - min));		

	      dataLock.setValue(i, j, benchLock[i][j] );
	      tooltipStringsLock[idx] = "w:" + work[i] + ", threads:" + j + " = " + benchLock[i][j] + "% of predicted speedup";

	      dataCAS.setValue(i, j, benchCAS[i][j] );
	      tooltipStringsCAS[idx] = "w:" + work[i] + ", threads:" + j + " = " + benchCAS[i][j] + "% of predicted speedup";

	      idx++;
	    }
          }

         // Don't fill polygons in IE. It's too slow.
         var fillPly = !isIE();
//	 var fillPly = false;

         // Define a colour gradient.
         var colour1 = {red:0, green:0, blue:255};
         var colour2 = {red:0, green:255, blue:255};
         var colour3 = {red:0, green:255, blue:0};
         var colour4 = {red:255, green:255, blue:0};
         var colour5 = {red:255, green:0, blue:0};
//         var colours = [colour1, colour2, colour3, colour4, colour5];
         var colours = [colour5, colour4, colour3, colour2, colour1];

         // Axis labels.
         var xAxisHeader = "Work between critical sections";
         var yAxisHeader = "Threads";
         var zAxisHeader = "Speedup as % of predicted";

         var optionsLock = {xPos: 0, yPos: 0, width: 800, height: 800, colourGradient: colours,
		   fillPolygons: fillPly, tooltips: tooltipStringsLock, xTitle: xAxisHeader,
		   yTitle: yAxisHeader, zTitle: zAxisHeader};	
         var lockPlot = new greg.ross.visualisation.SurfacePlot(document.getElementById("lockPlot"));			
         lockPlot.draw(dataLock, optionsLock);

         var optionsCAS = {xPos: 0, yPos: 0, width: 800, height: 800, colourGradient: colours,
		   fillPolygons: fillPly, tooltips: tooltipStringsCAS, xTitle: xAxisHeader,
		   yTitle: yAxisHeader, zTitle: zAxisHeader};
         var casPlot = new greg.ross.visualisation.SurfacePlot(document.getElementById("casPlot"));			
         casPlot.draw(dataCAS, optionsCAS);
      }
			
      </script>
		
    Observed speedup as a percentage of naively predicted speedup.  Work
    quantity is log scale.  Drag to rotate.

    <p><h2>Lock-based</h2><p><div id='lockPlot' style='align:center;'></div>

    <p><h2>CAS-based</h2><p><div id='casPlot' style='align:center;'></div>
		
    </body>
</html>
